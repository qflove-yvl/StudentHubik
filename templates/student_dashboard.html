{% extends "base.html" %}
{% block content %}

<h1 class="page-title">Кабинет студента</h1>

<div class="card-grid">

    <div class="card">
        <div class="card-title">Группа</div>
        <div class="card-value">{{ current_user.group_id or '—' }}</div>
    </div>

    <div class="card">
        <div class="card-title">Средний балл</div>
        <div class="card-value">{{ average_grade }}</div>
    </div>

    <div class="card">
        <div class="card-title">Предметы</div>
        <div class="card-value">{{ subject_count }}</div>
    </div>

    <div class="card">
        <div class="card-title">Лучшая оценка</div>
        <div class="card-value">{{ best_grade }}</div>
    </div>

    <div class="card">
        <div class="card-title">Минимальная оценка</div>
        <div class="card-value">{{ worst_grade }}</div>
    </div>

</div>

<section class="card list-card student-grades">
    <h2>Мои оценки</h2>

    <input type="text" id="student-grade-search" class="input-field" placeholder="Поиск по предмету">

    {% if grades %}
    <div class="table-wrap">
        <table class="grade-table" id="student-grade-table">
            <thead>
                <tr>
                    <th>Предмет</th>
                    <th>Оценка</th>
                </tr>
            </thead>
            <tbody>
                {% for item in grades %}
                <tr>
                    <td>{{ item.subject.name }}</td>
                    <td><span class="badge">{{ item.grade }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="muted-text">Оценок пока нет.</p>
    {% endif %}
</section>

<script>
const studentSearch = document.getElementById('student-grade-search');
const studentTable = document.getElementById('student-grade-table');

if (studentSearch && studentTable) {
    studentSearch.addEventListener('input', () => {
        const query = studentSearch.value.toLowerCase().trim();
        const rows = studentTable.querySelectorAll('tbody tr');

        rows.forEach((row) => {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(query) ? '' : 'none';
        });
    });
}
</script>

{% endblock %}
